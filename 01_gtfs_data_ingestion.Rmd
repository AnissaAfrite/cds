---
title: "Chicago GTFS data"
author: "jan.zymla"
output: html_notebook
---

```{r}
library(tidyverse)
library(data.table)
library(magrittr)
library(lubridate)
library(purrr)
```
GTFS data feed is available at `https://www.transitchicago.com/downloads/sch_data`
```{r}

```

```{sql}
DROP TABLE IF EXISTS agency;
CREATE TABLE agency
(
--  agency_id VARCHAR(100) NOT NULL PRIMARY KEY,
  agency_name VARCHAR(100),
  agency_url TEXT,
  agency_timezone VARCHAR(100),
  agency_lang VARCHAR(50),
  agency_phone VARCHAR(50),
  agency_fare_url VARCHAR(100)
)
```

```{sql}
COPY agency(agency_name, agency_url, agency_timezone, agency_lang, agency_phone, agency_fare_url) 
FROM '/extdata/agency.txt' DELIMITER ',' CSV HEADER;
```
```{sql}
CREATE TABLE calendar
(
  service_id VARCHAR(100) NOT NULL,
  monday SMALLINT,
  tuesday SMALLINT,
  wednesday SMALLINT,
  thursday SMALLINT,
  friday SMALLINT,
  saturday SMALLINT,
  sunday SMALLINT,
  start_date DATE,
  end_date DATE,
  start_date_str CHAR(8),
  end_date_str CHAR(8));
```
```{sql}
COPY calendar(service_id, monday, tuesday, wednesday, thursday, friday, saturday, sunday, start_date_str, end_date_str) 
FROM '/extdata/calendar.txt' DELIMITER ',' CSV HEADER;
```

```{sql}
UPDATE calendar SET start_date = to_date(start_date_str, 'YYYYMMDD')::date;
UPDATE calendar SET end_date = to_date(end_date_str, 'YYYYMMDD')::date;
```

